<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.acorn.SightsMapper"> 
    <!-- content 전체 갯수 -->
	<select id="totalCnt" resultType="java.lang.Integer" parameterType="int">
	    SELECT COUNT(*) FROM contentInfoTbl
	    <where>
	        <if test="sidoCode != 0">
	            AND sidoCode = #{sidoCode}
	        </if>
	        AND contenttypeid IN('12', '14', '28', '39')
	    </where>
	</select>
	
	<!-- 지역별 최신순 content 10개씩 조회 -->
	<select id="selectAllLatest" resultType="SightDTO" parameterType="map">
	    SELECT *
        FROM (
            SELECT rownum AS num, contentid, title, sidoCode, sigungucode, firstimage
            FROM (
                SELECT *
                FROM contentInfoTbl
                <where>
                    <if test="sidoCode != 0">
                        AND sidoCode = #{sidoCode}
                    </if>
                    AND contenttypeid IN ('12', '14', '28', '39')
                </where>
                ORDER BY createdtime DESC
            )
        ) ct
        JOIN SidoTbl sd ON sd.sidocode = ct.sidocode
        JOIN SigunguTbl sg ON sg.sigungucode = ct.sigungucode
        WHERE num BETWEEN #{startList} AND #{endList}
        ORDER BY num
	</select>
	
	<!-- 거리별 content 전체 -->
	<select id="distanceAll" resultType="SightDTO" parameterType="int">
	    SELECT contentid, mapx, mapy
	    FROM contentInfoTbl
	    WHERE 
	        <if test="sidoCode != 0">
	            sidoCode = #{sidoCode}
	        </if>
	        AND contenttypeid IN('12', '14', '28', '39')
	</select>
	
	<!-- 거리별로 정렬된 리스트 10개씩 표출 -->
	<select id="selectAllDistance" resultType="SightDTO" parameterType="String">
	    SELECT ct.contentid, ct.title, ct.sidoCode, sd.nickName AS nickname, sg.sigungucode, sg.name, ct.firstimage
	    FROM (
	        SELECT contentid, title, sidoCode, sigungucode, firstimage
	        FROM contentInfoTbl
	        <where>
	            <if test="sidoCode != 0">
	                AND sidoCode = #{sidoCode}
	            </if>
	            <if test="contentIds != null">
	                AND contentid IN
	                <foreach collection="contentIds" item="contentId" open="(" close=")" separator=",">
	                    #{contentId}
	                </foreach>
	            </if>
	        </where>
	    ) ct
	    JOIN SidoTbl sd ON sd.sidocode = ct.sidoCode
	    JOIN SigunguTbl sg ON sg.sigungucode = ct.sigungucode
	</select>
	
	<!-- 인기순 -->
	<select id="selectAllPopular" resultType="SightDTO" parameterType="map">
	    SELECT ct.contentid, ct.title, ct.sidoCode, sd.nickName, sg.sigungucode, sg.name, ct.firstimage
	    FROM (
	        SELECT ROWNUM AS rnum , contentid, title, sidoCode, sigungucode, firstimage, view_cnt
	        FROM contentInfoTbl
	        <where>
	            <if test="sidoCode != 0">
	                AND sidoCode = #{sidoCode}
	            </if>
	            AND contenttypeid IN('12', '14', '28', '39')
	        </where>
	        ORDER BY view_cnt DESC
	    ) ct
	    JOIN SidoTbl sd ON sd.sidocode = ct.sidocode
	    JOIN SigunguTbl sg ON sg.sigungucode = ct.sigungucode
	    WHERE rnum BETWEEN #{startList} AND #{endList} 
	    ORDER BY rnum
	</select>
	
	<!-- 상세페이지에 표출할 내용 -->
	<select id="selectOne" resultType="SightDTO" parameterType="string">
	    SELECT ct.contentid, ct.title, sd.sidoCode, sd.nickname, sg.sigungucode, sg.name,
	           ct.address, ct.firstimage, ct.tel, ct.view_cnt, ct.mapx, ct.mapy, ct.homepage,
	           ct.overview, ar.infocenter, ar.restdate, ar.expguide, ar.usetime, ar.parking
	    FROM contentInfoTbl ct
	    JOIN SidoTbl sd ON sd.sidocode = ct.sidocode
	    JOIN SigunguTbl sg ON sg.sigungucode = ct.sigungucode
	    LEFT OUTER JOIN areatbl ar ON ar.contentid = ct.contentid
	    WHERE ct.contentid = #{contentId}
	</select>

    
 
</mapper>